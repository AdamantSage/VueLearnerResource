<h2 class="page-header">Show and Videos</h2>
<h2 class="page-header"> <%= video.title %></h2>

<div class="video-container">
    <% if (video.link) {
        let videoId = null;
        
        // Regular YouTube URL (https://www.youtube.com/watch?v=VIDEO_ID)
        if (video.link.includes('v=')) {
            videoId = video.link.split('v=')[1]?.split('&')[0];
        }
        // Handle shortened YouTube URL (https://youtu.be/VIDEO_ID)
        else if (video.link.includes('youtu.be/')) {
            videoId = video.link.split('youtu.be/')[1];
        }
        
        // If videoId is found, embed the video
        if (videoId) { %>
            <iframe width="560" height="315" 
                src="https://www.youtube.com/embed/<%= videoId %>" 
                frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
            </iframe>
        <% } else { %>
            <p>Invalid YouTube link or video ID not found.</p>
        <% } 
    } else { %>
        <p>Missing YouTube link.</p>
    <% } %>
</div>

<script>
    // Get modal and open button
    const modal = document.getElementById("videoModal");
    const openButton = document.getElementById("openVideoModal");
    const closeButton = document.getElementsByClassName("close")[0];
    const videoFrame = document.getElementById("videoFrame");

    // Open the modal
    openButton.onclick = function() {
        modal.style.display = "block";
        // Dynamically set the video source based on the YouTube link
        let videoLink = "<%= video.link %>";
        let videoId = null;

        if (videoLink.includes('v=')) {
            videoId = videoLink.split('v=')[1]?.split('&')[0];
        } else if (videoLink.includes('youtu.be/')) {
            videoId = videoLink.split('youtu.be/')[1];
        }

        if (videoId) {
            videoFrame.src = "https://www.youtube.com/embed/" + videoId;
        }
    }

    // Close the modal
    closeButton.onclick = function() {
        modal.style.display = "none";
        videoFrame.src = ""; // Stop the video when the modal is closed
    }

    // Close the modal if the user clicks outside of it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
            videoFrame.src = ""; // Stop the video
        }
    }
</script>

<div class="form-row video-buttons">
    <% if (userRole === 'Admin') { %>
        <!-- Show the edit and delete buttons only for admin role -->
        <a class="btn btn-primary" href="/dashboard/<%= video.id %>/edit">Edit</a>
        <form action="/dashboard/<%= video.id %>?_method=DELETE" method="POST">
            <button class="btn btn-danger" type="submit">Delete</button>
        </form>
    <% } %>
</div>
